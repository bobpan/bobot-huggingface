<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>记忆方块挑战</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* CSS Reset and Global Styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            user-select: none;
        }

        .game-container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            max-width: 450px;
            width: 100%;
            text-align: center;
        }

        h1 {
            color: #1e3a8a;
            font-size: 2rem;
            margin-bottom: 10px;
        }

        p#message {
            font-size: 1.1rem;
            color: #3b82f6;
            min-height: 24px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        /* Game Board Grid */
        .game-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 12px;
            width: 100%;
            aspect-ratio: 1 / 1; /* Keep it square */
            margin: 0 auto 20px;
        }

        .tile {
            min-height: 80px;
            border-radius: 10px;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.2s, box-shadow 0.1s, transform 0.1s;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: white;
            font-size: 1.5rem;
        }

        /* Tile Colors */
        .tile[data-id="1"] { background-color: #ef4444; } /* Red */
        .tile[data-id="2"] { background-color: #f97316; } /* Orange */
        .tile[data-id="3"] { background-color: #f59e0b; } /* Yellow */
        .tile[data-id="4"] { background-color: #10b981; } /* Green */
        .tile[data-id="5"] { background-color: #06b6d4; } /* Cyan */
        .tile[data-id="6"] { background-color: #3b82f6; } /* Blue */
        .tile[data-id="7"] { background-color: #8b5cf6; } /* Indigo */
        .tile[data-id="8"] { background-color: #ec4899; } /* Pink */
        .tile[data-id="9"] { background-color: #64748b; } /* Slate */

        /* Interaction States */
        .tile.clickable:hover {
            opacity: 1;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.7);
            transform: scale(1.02);
        }

        .tile.flash {
            opacity: 1;
            box-shadow: 0 0 20px 5px rgba(255, 255, 255, 0.9);
            transform: scale(1.05);
            transition: all 0.05s ease-in;
        }

        /* Button */
        button {
            padding: 12px 25px;
            font-size: 1.1rem;
            font-weight: bold;
            color: white;
            background-color: #10b981;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(16, 185, 129, 0.4);
            transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s;
        }

        button:hover {
            background-color: #059669;
            box-shadow: 0 6px 12px rgba(16, 185, 129, 0.6);
        }

        button:active {
            transform: translateY(1px);
            box-shadow: 0 3px 6px rgba(16, 185, 129, 0.4);
        }

        button:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* Responsive Adjustments */
        @media (max-width: 500px) {
            .game-container {
                padding: 20px;
                margin: 10px;
            }
            h1 {
                font-size: 1.5rem;
            }
            p#message {
                font-size: 1rem;
            }
            .tile {
                min-height: 60px;
            }
            button {
                padding: 10px 20px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>

    <div class="game-container">
        <h1>记忆方块挑战</h1>
        <p id="score-display">当前分数: 0</p>
        <p id="message">点击 "开始游戏" 来开始挑战你的记忆力！</p>

        <div class="game-board" id="game-board">
            <div class="tile" data-id="1">1</div>
            <div class="tile" data-id="2">2</div>
            <div class="tile" data-id="3">3</div>
            <div class="tile" data-id="4">4</div>
            <div class="tile" data-id="5">5</div>
            <div class="tile" data-id="6">6</div>
            <div class="tile" data-id="7">7</div>
            <div class="tile" data-id="8">8</div>
            <div class="tile" data-id="9">9</div>
        </div>

        <button id="start-button" onclick="startGame()">开始游戏</button>

        <!-- Custom Modal for Alerts/Messages -->
        <div id="modal" style="display:none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
            <div style="background: white; padding: 30px; border-radius: 12px; text-align: center; max-width: 90%; min-width: 300px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                <h2 id="modal-title" style="color: #ef4444; margin-top: 0;"></h2>
                <p id="modal-body" style="font-size: 1.1rem; margin-bottom: 20px;"></p>
                <button onclick="hideModal()" style="background-color: #3b82f6;">确定</button>
            </div>
        </div>
    </div>

    <script>
        // --- 游戏状态 ---
        let gameSequence = [];
        let playerSequence = [];
        let score = 0;
        let isPlayerTurn = false;
        let isGameRunning = false;
        let tiles = document.querySelectorAll('.tile');
        const startButton = document.getElementById('start-button');
        const messageDisplay = document.getElementById('message');
        const scoreDisplay = document.getElementById('score-display');
        const board = document.getElementById('game-board');

        // --- 工具函数：显示自定义模态框（替代alert）---
        function showModal(title, body) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-body').textContent = body;
            document.getElementById('modal').style.display = 'flex';
        }

        function hideModal() {
            document.getElementById('modal').style.display = 'none';
        }

        // --- 游戏流程 ---

        // 1. 开始游戏
        function startGame() {
            if (isGameRunning) return;
            isGameRunning = true;
            score = 0;
            gameSequence = [];
            playerSequence = [];
            updateScoreDisplay();
            messageDisplay.textContent = '游戏开始！请准备记忆。';
            startButton.disabled = true;
            nextRound();
        }

        // 2. 下一回合
        function nextRound() {
            isPlayerTurn = false;
            playerSequence = [];
            score++;
            updateScoreDisplay();
            
            // 随机添加一个新的方块到序列
            const nextTileId = String(Math.floor(Math.random() * 9) + 1);
            gameSequence.push(nextTileId);

            messageDisplay.textContent = `第 ${score} 关：请记住序列...`;
            
            // 播放序列
            playSequence();
        }

        // 3. 播放序列
        function playSequence() {
            let i = 0;
            const delay = 600; // 闪烁时间
            const interval = 200; // 间隔时间
            
            const sequenceTimer = setInterval(() => {
                if (i < gameSequence.length) {
                    const tileId = gameSequence[i];
                    flashTile(tileId);
                    i++;
                } else {
                    clearInterval(sequenceTimer);
                    setTimeout(() => {
                        isPlayerTurn = true;
                        messageDisplay.textContent = '轮到你了！请按正确的顺序点击。';
                        enablePlayerInteraction();
                    }, interval);
                }
            }, delay + interval);
        }

        // 4. 闪烁方块
        function flashTile(tileId) {
            const tile = document.querySelector(`.tile[data-id="${tileId}"]`);
            if (tile) {
                // 添加闪烁类
                tile.classList.add('flash');
                setTimeout(() => {
                    // 移除闪烁类
                    tile.classList.remove('flash');
                }, 300); // 闪烁持续时间
            }
        }

        // 5. 处理玩家点击
        function handleTileClick(event) {
            if (!isGameRunning || !isPlayerTurn) return;

            const clickedTile = event.target.closest('.tile');
            if (!clickedTile) return;

            const tileId = clickedTile.dataset.id;
            
            // 闪烁被点击的方块
            flashTile(tileId);

            playerSequence.push(tileId);
            const playerIndex = playerSequence.length - 1;

            // 检查点击是否正确
            if (playerSequence[playerIndex] === gameSequence[playerIndex]) {
                // 点击正确
                if (playerSequence.length === gameSequence.length) {
                    // 序列完成
                    disablePlayerInteraction();
                    messageDisplay.textContent = '序列正确！准备进入下一关...';
                    setTimeout(nextRound, 1000); // 1秒后进入下一关
                }
            } else {
                // 点击错误
                gameOver();
            }
        }

        // 6. 游戏结束
        function gameOver() {
            isGameRunning = false;
            disablePlayerInteraction();
            startButton.disabled = false;
            startButton.textContent = '重新开始';
            messageDisplay.textContent = `游戏结束！你的得分为 ${score - 1} 分。`;
            showModal('游戏结束', `很遗憾，你未能记住序列。你的最终得分为 ${score - 1} 分。`);
        }

        // 7. 交互控制
        function enablePlayerInteraction() {
            tiles.forEach(tile => {
                tile.classList.add('clickable');
                tile.addEventListener('click', handleTileClick);
            });
            board.style.pointerEvents = 'auto'; // 确保父容器可以接收点击
        }

        function disablePlayerInteraction() {
            tiles.forEach(tile => {
                tile.classList.remove('clickable');
                tile.removeEventListener('click', handleTileClick);
            });
            board.style.pointerEvents = 'none'; // 禁用点击
        }

        // 8. UI 更新
        function updateScoreDisplay() {
            scoreDisplay.textContent = `当前分数: ${score - 1 < 0 ? 0 : score - 1}`;
        }

        // --- 初始化 ---
        window.onload = function() {
            // 初始状态：禁用点击
            disablePlayerInteraction();
            // 为所有方块添加点击事件，但在玩家回合外会忽略
            tiles.forEach(tile => {
                tile.addEventListener('click', handleTileClick);
            });
        };
    </script>

</body>
</html>
